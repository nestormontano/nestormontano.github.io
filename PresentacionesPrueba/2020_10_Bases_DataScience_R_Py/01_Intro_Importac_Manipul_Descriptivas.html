<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introducción al análisis de datos usando R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Zulemma Bazurto / Néstor Montaño" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/xaringanExtra_fit-screen/fit-screen.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introducción al análisis de datos usando R
## Curso: Bases para Data Science - Estadística, R y Python
### Zulemma Bazurto / Néstor Montaño
### Sociedad Ecuatoriana de Estadística
### Octubre-2020

---

class: hide_logo 
background-image: url("Imagenes/Logo-BanderaCorregida_con_curva_peque.png")


&lt;style type="text/css"&gt;
.huge .remark-code { /*Change made here*/
  font-size: 150% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 75% !important;
}

&lt;/style&gt;

<div>
<style type="text/css">.xaringan-extra-logo {
width: 800px;
height: 50px;
z-index: 0;
background-image: url(Imagenes/Top_Logo.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0;right:0.4em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>


---

.footnote[
**Nota:**  
Con *Alt + F* o  *Option + F* puede hacer que estas dapositivas ocupen todo el navegador (es decir que se ignore el aspecto de diapositiva que tiene por default la presentación)
]

---
class: inverse, center, middle, hide_logo

# Introducción a R y RStudio

## Curso: Bases para Data Science - Estadística, R y Python
### Zulemma Bazurto / Néstor Montaño


---
# Instalar 

.pull-left[
##R
- En windows y Mac descargar R desde [CRAN](http://cran.r-project.org/) 
- Instalarlo como cualquier otro software
- En Linux, distribuciones basadas en Debian/Ubuntu tienen R en los repositorios oficiales
- En Linux, distribuciones basadas en Fedora/RedHat deben habilitar EPEL para tener R
- En Debian Estable para tener nuevas versiones se debe utilizar un ["backports"](https://cran.r-project.org/bin/linux/debian/)
]

.pull-right[
##RStudio
- Debe estar R ya instalado
- Descargar según Sistema Operativo [web oficial](http://www.rstudio.com/products/rstudio/download/)
- En Windows/Mac es next&amp;next
- En linux Debian/Ubuntu/Mint se puede instalar desde el .deb y next&amp;next 
- En linux desde consola hay que seguir las instrucciones de la web oficial
- En linux Red Hat/CentOS/Fedora tener cuidado con las dependencias
]


---
# ¿Por qué R?

--
&lt;img src="Imagenes/CorreQueVaAHablarDeR.png" width="70%" style="display: block; margin: auto;" /&gt;



---
#R: Algo de historia

Mientras S cambiaba de dueño y denominación , Ross Ihaka y Robert Gentleman, decidieron implementar su propio dialecto, era 1991 cuando estos dos neozelandeses crearon R.

Tardaron dos años en anunciarlo públicamente y otros dos años más en licenciarlo bajo GPL, ésta última decisión fue posiblemente la responsable de que hoy R tenga tanta repercusión.

Ross Ihaka and Robert Gentleman. R: A language for data analysis and graphics. Journal of Computational and Graphical Statistics, 5(3):299–314, 1996



---
# ¿Por qué R?


.pull-left[
- Software Libre (Open Source), gratuito y de desarrollo independiente,
- Uno de los lenguajes más usados para Data Science,
- Posee uno de los mejores sistemas gráficos existentes,
- Gran y creciente cantidad de usuarios y desarrolladores,
- CRAN: +12000 paquetes disponibles y aparte hay paquetes instalables desde GitHub
- Curva de aprendizaje simple (desde que apareció el tidyverse),
- Actualmente la mayoría de U en las carreras no computacionales enseñan análisis de datos con R.
]

.pull-right[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="Imagenes/r_community.png" alt="Comunidad R" width="80%" /&gt;
&lt;p class="caption"&gt;Comunidad R&lt;/p&gt;
&lt;/div&gt;
fuente: [Open Data Science - Medium](https://medium.com/@ODSC/data-driven-exploration-of-the-r-user-community-worldwide-57416018e958)
]


---
# ¿Por qué R?


.pull-left[
- Flexible y se integra bien con otros sistemas u aplicaciones: Bases de datos, software de inteligencia de negocios, etc.
- Rico ecosistema de paquetes libres y pagados que extienden las capacidades de R
- La mayoría de los nuevos métodos estadísticos se desarrollan primero en R,
- Para programar en R se pueden usar algunas IDEs (Interfaz de desarrollo) como [Eclipse](https://projects.eclipse.org/projects/science.statet), [Emmacs](http://www.gnu.org/software/emacs/) y [Rstudio](https://rstudio.com/products/rstudio/) que es la más usada,
- Puedes probar las diferentes GUI disponibles como [Rcmdr](https://socialsciences.mcmaster.ca/jfox/Misc/Rcmdr/) fuerte en investigación de mercado, [Rattle](https://rattle.togaware.com/) útil para data mining o [rkward](https://rkward.kde.org/) en linux.
]

.pull-right[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="Imagenes/r_integraciones.png" alt="Algunas de las integraciones de R" width="80%" /&gt;
&lt;p class="caption"&gt;Algunas de las integraciones de R&lt;/p&gt;
&lt;/div&gt;
]



---
# Derivados de R

.pull-left[
- [BIOCONDUCTOR](http://www.bioconductor.org/) Herramientas para analizar Genoma con base R
- [ORACLE R ENTERPRISE](http://www.oracle.com/technetwork/database/database-technologies/r/r-enterprise/overview/index.html) Integra R con Oracle Data Base
- [Microsoft R Application Network](https://mran.microsoft.com/) Microsoft R Application Network
- [RAPPORTER](http://rapporter.net/welcome/en) Reportería y análisis en la nube
- [RSTUDIO](https://www.rstudio.com/) Desarrollos como RStudio Server, Shiny server y paquetes en general
- [RSTUDIO Cloud](https://www.rstudio.com/) Ejecutar R online
- [Kernels de Kaggle](https://www.kaggle.com/kernels?language=R) Kaggle tiene datasets, concursos y también kerneles que permiten ejecutar R en sus servidores 
- [Google Colab](https://colab.research.google.com/notebook#create=true&amp;language=r) Permite ejecutar R online.
]

.pull-right[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="Imagenes/rstudio_cloud.png" alt="RStudio Cloud" width="80%" /&gt;
&lt;p class="caption"&gt;RStudio Cloud&lt;/p&gt;
&lt;/div&gt;
]


---
# RStudio

Abrir RStudio   

&lt;img src="Imagenes/Abrir_RStudio.png" width="80%" style="display: block; margin: auto;" /&gt;


---
# RStudio

Interfaz de RStudio se divide en 4 paneles:

&lt;img src="Imagenes/Partes_RStudio.JPG" width="90%" style="display: block; margin: auto;" /&gt;


---
# RStudio

.pull-left[
1. Script: Pantalla donde se escriben las líneas de código   
2. Consola: Donde se muestra el código ejecutado y el resultado   
3. Environment/History: Pantalla donde se puede observar la data almacenada, los valores determinados.   
4. File/plots/packages/help/viewer: en esta pantalla esta particionada en varias pestañas como:   
   - Files.- Explorador de carpetas y archivos
   - Plots/Viewer.- Visor de gráficos o aplicaciones
   - Packages/Ayuda.- Muestra paquetes instalados del R y la ayuda de R
   - Help.- las ayudas internas del sistema
]

.pull-right[

&lt;img src="Imagenes/Partes_RStudio.JPG" style="display: block; margin: auto;" /&gt;
]


---
# ¿Por qué RStudio?
RStudio es la IDE más usada de R, a lo largo de este y otros cursos irán descubriendo caracterísiticas de este software, por ahora podemos numerar lo siguiente:

- Todo en 1-ventana: Console, Workspace, History, Working directory, Files, Plot, Packages y Help
- Integracion de la consola de R
- Ejecutar codigo desde script
- Resaltado de sintaxis
- Completado de sintaxis
- Manejo de proyectos con soporte para Git y Subversion
- Herramientas para Investigación Reproducible (knitr)

**¿IDE vs GUI?**  
Una IDE es una interfaz que facilita la escritura de código, en nuestro caso facilita hacer los srcipts que usaremos para nuestros análisis. Una GUI en cambio disminuye o elimina el uso de código, se realizan las operaciones con una serie de clicks en lugar de escribir código.



---
#Proyectos en R, RStudio

.pull-left[
- Un **Proyecto** es una carpeta que contiene todos los scripts, los archivos desde donde se importan los datos y los archivos de proyecto como el .RData (que contiene los objetos con los que se está trabajando) y .Rhistory (que contiene la historia de comandos ejecutados)
- Permite tener nuestros análisis ordenados,
- Al abrir un proyecto antiguo RStudio lo abre con las pestañas que se tenía activas,
- Permite colaboración utilizando GIT o Subversion,
- Se sugiere tener una estructura interior, por ejemplo:
  - Scripts, Data, Exports, Info
]

.pull-right[
&lt;img src="Imagenes/Estructura_Carpetas.png" width="60%" style="display: block; margin: auto;" /&gt;
]




---
# Iniciar un Proyecto en RStudio
.pull-left[
&lt;img src="Imagenes/CreateProyect_RSTUDIO.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
- Crear un Nuevo Proyecto.-    
  Project &gt;  
  ..New Project &gt;  
  ...New Directory &gt;  
  ....Empty Project &gt;  
  .....Poner nombre al Proyecto (se creará una carpeta con ese nombre) &gt;  
  ......Create Project  
  
- En la carpeta del proyecto crear las carpetas: Data, Exports, Scripts, Info (estructura recomendada, no obligatoria)
]


---
#Realizar un script en RStudio

- Nuevo script: `ctrl + shift + n`
- Completado de comando: `tab` , `ctrl + barra espaciadora`
- Ejecutar selección o linea actual:  `ctrl + enter`
- Ir al source editor: `ctrl + 1`
- Ir a la consola: `ctrl + 2`
- Insertar simbolo de asignación `&lt;-`: `alt + -`
- Comentar/des-comentar: `ctrl + shift + c`
- Reformatear linea: `ctrl + i`
- RStudio permite "plegar" código
- Crear secciones de código: `ctrl + shift + r` o `#### nombre ####`
- Saltar a (función o sección): `alt + shift + J`
- Ir a una función: `ctrl + .`



---
#Generalidades

- Case sensitivity (`Abc` es diferente de `abc`)
- R, aparte de objetos, tiene:
 - Expresión.- Se evalúa, se imprime y el valor se pierde

```r
  5+5 # Expresión
```

```
## [1] 10
```
 - Asignación.- Evalúa la expresión y guarda el resultado en una variable (no lo imprime)

```r
  a &lt;- 5+5 # Asigna el valor a la variable "a"
```


---
#Generalidades


- Comandos se separan por `;` o `enter`
- Comandos pueden ser agrupados por `{}`
- Para comentar se usa `#`
- SAS y SPSS presentan extensos resultados, mientras que en R la salida es mínima (*En R un análisis se realiza mediante una serie de pasos, con resultados intermedios guardados en objetos*)



---
#R como calculadora


```r
2 + 3*5
```

```
## [1] 17
```

```r
log((1+2+3)/4) # log natural 
```

```
## [1] 0.4054651
```

```r
pi^2 # pi y potencia
```

```
## [1] 9.869604
```


---
#R como calculadora


```r
abs(-2) # valor abosluto 
```

```
## [1] 2
```

```r
factorial(3) # factorial
```

```
## [1] 6
```

```r
floor(5.7) # funcion piso
```

```
## [1] 5
```


---
#Generar secuencias, repeticiones y aleatorios


```r
1:10 # secuencia de 1 a 10, de 1 en 1
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10
```

```r
seq(from= 0, to= 20, by= 5) # función seq
```

```
## [1]  0  5 10 15 20
```

```r
seq(from= 5, by= 5, length.out= 5) # función seq
```

```
## [1]  5 10 15 20 25
```


---
#Generar secuencias, repeticiones y aleatorios


```r
rep(x= 3, times= 5) # repetir 5 veces el # 3
```

```
## [1] 3 3 3 3 3
```

```r
runif(n= 10, min= 1, max= 5) # Genera aleatorios uniformes
```

```
##  [1] 4.968303 2.299874 2.012091 2.516704 4.791045 2.281105 4.483970 3.581672
##  [9] 4.036126 1.272225
```

```r
rnorm(n= 10, mean= 100, sd= 10) # Genera aleatorios normales
```

```
##  [1] 112.32745  99.26670 110.27949 106.04594 105.77093 100.41542 112.33845
##  [8] 108.36887 102.10022  91.31364
```



---
#Asignaciones

- asigna el valor `5` a la variable `a`   :
  - `a &lt;- 5`
  - `5 -&gt; a`
  - `assign("a", 5)`  
  
- asigna globalmente el valor `5` a la variable `a`, (dentro de una función `a` seguirá valiendo 5)    
  - `a &lt;&lt;- 5`
  -   `5 -&gt;&gt; a` 
  
- No se recomiendo usar `a = 5`

- En RStudio verificar en la pestaña Environment la variable `a`


---
# Asignaciones 


- El resultado de una función de un objeto X puede ser asignada al mismo objeto X en la misma sentencia, es decir 

```r
a &lt;- 5 # Expresión
a
```

```
## [1] 5
```

```r
a &lt;- 2*a
a
```

```
## [1] 10
```



---
# Workspace, environments y objetos


- Environment es donde se guardan las variables y objetos de R  
- Tecnicamente es un conjunto de objetos y un puntero   
- El environment por defecto es el workspace o .GlobalEnv  
- Objetos en el workspace: `ls()` y `objects()`
- Para eliminar objetos: `rm` 
- Obtener los objetos de un environment específico: `ls(envir=  name_env)`
  - ejemplo: `ls(envir=  globalenv())`  
- El workspace se graba predeterminado con el nombre `.RData`
- RStudio permite el acceso desde su pestaña "Environment"





---
# Workspace, environments y objetos


- Guardar workspace `save.image()`
- Guardar workspace bajo nombre/ruta definida `save.image(file= ruta.RData)`
- Guardar algunos objetos `save(lista_objetos, file = 'file_name.RData')`
- Guardar un único objeto `ssaveRDS(object, file = 'file_name.rds')`
- Cargar un archivo .RData `load(file = ‘filename.Rdata’)`
- Cargar un archivo .RData `obj &lt;- readRDS(file = ‘filename.rds’)`



---
# Historico de comandos (History)


- En la consola se puede acceder a los comandos anteriores con las flechas del teclado
- RStudio, abrir un histórico desplegable en la consola: `Ctrl + Up`
- Obtener el histórico: `history(max.show = 25)`
  - En la GUI oficial para Windows/Mac abrirá una nueva ventana, en linux se presentará en el mismo terminal
  - En RStudio `history()` nos lleva a la pestaña "History"
- Guardar el historico: `savehistory(file = '.Rhistory')` 
- Cargar el historico desde un archivo: `loadhistory(file = '.Rhistory')` 




---
# Manejo de paquetes


- Instalación: `install.packages('nombre_paquete')`
- Ver paquetes instalados: `installed.packages()`
- Activar/Cargar: `library('nombre_paquete')`
- Desactivar/Des-cargar: `detach('package:nombre_paquete')`
- Paquetes cargados: `search()`
- RStudio tiene pestaña Packages que permite instalación visual





---
# Paquetes a usar




```r
install.packages("openxlsx") # Para importar desde excel
install.packages("tidyverse") # Manipulación de datos y ggplot2
install.packages("magrittr") # pipe
install.packages('modeest') # Obtener moda
install.packages('fdth') # Calcular tabla frecuencias
install.packages("prettyR") # Opcion de Descriptivas
```




---
class: inverse, center, middle, hide_logo

# Introducción a los análisis estadísticos

## Curso: Bases para Data Science - Estadística, R y Python
### Zulemma Bazurto / Néstor Montaño





---
# Workflow de un análisis estadístico


&lt;img src="Imagenes/WorkFlow_dataScience.png" width="689" style="display: block; margin: auto;" /&gt;

- Import: Obtener y entender los datos
- Tidy: Ordenar los datos de tal manera que sea sencillo transformarlos, sumarizarlo, visualizarlos o realizar un modelo con ellos
- Transform: Manipular los datos hasta obtener el input que el análisis o técnica estadística necesita
- Visualise: Realizar el análisis exploratorio de datos
- Model: Aplicar técnicas estadísticas para el entendimiento del problema o tomar decisiones
- Comunicate: Tratar de mostrar los resultados de tal forma que el resto del mundo los entienda, usando reportes, gráficos, visualizaciones interactivas, integración con herramientas de BI, web apps, etc. 




---
# Workflow de un análisis estadístico


&lt;img src="Imagenes/WorkFlow_dataScience.png" width="689" style="display: block; margin: auto;" /&gt;

- Import
- Tidy  
**Repetir mientras sea necesario**
- **Transform:** Manipular los datos, obtener el input del modelo
- **Visualise:** Realizar el análisis exploratorio de datos
- **Model:** Aplicar técnicas estadísticas   
- Comunicate




---
class: center, middle, hide_logo

# Importar datos
## Introducción al análisis de datos 





---
# Importar csv


- Desde RStudio (R-base o paquete `readr`)    
  Import Dataset &gt; From Text File &gt; Escoger archivo &gt; Abrir &gt; Escribir nombre a la variable &gt; Import
- Con comando    
  `read.csv( file, sep = "," , dec = "," , stringsAsFactors= FALSE)`
- Para grandes volúmenes de datos usar paquete `data.table`   
  `fread()`
- Paquete `vromm` en desarrollo,   
  `vroom()` 



---
# Importar desde excel



- Copiando desde un archivo de excel abierto  
  `read.table("clipboard", sep="\t", header=TRUE)`
- Desde RStudio  
  Rstudio &gt; Import Dataset &gt; From Excel &gt; Escoger archivo &gt; Abrir &gt; Escribir nombre a la variable &gt; Import
- Usando el paquete `openxlsx`  
  `read.xlsx(xlsxFile , sheet , startRow , colNames , skipEmptyRows, rowNames)`  
  `data_tiempo_espera &lt;- read.xlsx(xlsxFile = 'Data/Data_Banco.xlsx')`  
- Otros paquetes  
  `excel.link`, `XLConnect`, `xlsx`, `readxl`, `rio`





---
# Exportar a excel


- Descargar [Rtools] (https://cran.r-project.org/bin/windows/Rtools/)
- Instalar Rtools
  - Se debe escoger "agregar al path"
  - Si la computadora ya tiene CYGWIN, se tiene un tratamiento especial
- Usando el paquete `openxlsx`  
  `write.xlsx(x, file, asTable = FALSE, ...)`
- Se puede usar los paquetes `XLConnect`, `xlsx`, etc.
  





---
# Importar desde SPSS, SAS, Stata, etc


- Desde RStudio  
  Rstudio &gt; Import Dataset &gt; From SPSS/SAS/STATA
- Usando el paquete `foreign`  
  SAS: `read.xport()`  
  SPSS: `read.spss()` 
  Stata: `read.dta()`  
  Soporta otros formatos
- Usango el paquete `haven`  
  SAS: `read_sas()` y `read_xpt()`   
  SPSS: `read_sav()` y `read_por()`  
  Stata: `read_dta()`   
- Se puede usar el paquerte `rio`  
  


---
# Exportar a SPSS, SAS, Stata, etc


- Usango el paquete `foreign`    
  `write.foreign(df, datafile, codefile, package = c("SPSS", "Stata", "SAS"), ...)`
- Usango el paquete `haven`  
  SAS: `write_sas()`  
  SPSS: `write_sav()`  
  Stata `write_dta()`  
- Se puede usar el paquerte `rio`




---
# Interacción con Bases de Datos


- Utilizando ODBC `RODBC`   
  (Recomendado para Microsoft SQL)
- Utilizando JDBC `RJDBC`   
  (Usa java DBC)
- Paquetes para bases específicas  
  RMySQL, ROracle, RPostgreSQL, RSQLite, mongolite, RMongo, MonetDB.R, rmongodb



 
---
# Otros


- GIS sistemas de información geográfica con `rgal` y `raster`
- GoogleSpreadSheets con `googlesheets`
- Archivos Open Document Spreadsheets con `readODS`
- JSON data con `rjson` o `jsonlite` o `RJSONIO`





---
# Ejemplo: Data de transacciones bancarias


El Banco del Pacífico requiere mejorar los tiempos de atención al cliente en ventanilla, para ello ha recolectado esta información anónimamente para cada cajero y transacción realizada.   

Le suministran un excel con dos hojas:   

1. Tiene los datos de las transacciones, columnas: Sucursal, Cajero, ID_Transaccion, Transaccion, Tiempo_Servicio_seg, Nivel de satisfacción, Monto de la transaccion. 
2. Otra hoja que indica si en la sucursal se ha puesto o no el nuevo sistema.



---
# Ejemplo: Data de transacciones bancarias


**Revisar archivo de excel: Data_Banco.xlsx**   

Crear un proyecto en RStudio, con las carpetas Data, Exports, etc    

Poner en la carpeta Data, el excel suministrado




---
# Ejemplo - Importar




```r
# Cargar la libreria a utilizar
library(openxlsx)
```

```
## Warning: package 'openxlsx' was built under R version 3.6.3
```

```r
# Leer el archivo de excel y asignarlo al objeto data_banco
data_banco &lt;- read.xlsx(xlsxFile = "Data/Data_Banco.xlsx", sheet = "Data")
data_sucursal &lt;- read.xlsx(xlsxFile = "Data/Data_Banco.xlsx", sheet = "Data_Sucursal")
```



---
# Ejemplo - Importar


Bien, se han creado dos objetos en nuestro 'environment', entendamos un poco las estructuras de datos para poder explorar estos objetos




---
class: center, middle, hide_logo

# Estructuras de datos | Objetos
## Introducción a R 






---
# Estructuras de datos | Objetos


R cuenta con un sinnúmero de estructuras de dato (clases de objetos), los más usados son:
- Vector
- Matriz
- Data.frame
- Litas
- Serie de Tiempo
- Data.table



---
# Vectores



- En R no existen escalares, sino vectores de dim = 1

```r
x &lt;- 1 
is.vector(x)
```

```
## [1] TRUE
```
- Los vectores se crean con la función `c()`

```r
x &lt;- c(11, 12, 13, 14) # crea x
x  # presenta x
```

```
## [1] 11 12 13 14
```



---
# Vectores



- concatenar vectores

```r
z &lt;- c('a', 'b', 'c') # crea z
z  # presenta z
```

```
## [1] "a" "b" "c"
```

```r
y &lt;- c(x, 21, 31, x) # crea y
y  # presenta y
```

```
##  [1] 11 12 13 14 21 31 11 12 13 14
```



---
# Vectores



- Repetir vectores

```r
rep(z, times=5) # repetir todo el vector 5 veces
```

```
##  [1] "a" "b" "c" "a" "b" "c" "a" "b" "c" "a" "b" "c" "a" "b" "c"
```

```r
rep(z, each=5)  # repetir cada elemento 5 veces
```

```
##  [1] "a" "a" "a" "a" "a" "b" "b" "b" "b" "b" "c" "c" "c" "c" "c"
```



---
# Vectores



- Operaciones entre vectores

```r
x # presenta x
```

```
## [1] 11 12 13 14
```

```r
y &lt;- c(10, 20, 30, 40) # Crea y
x + 3*y - 1
```

```
## [1]  40  71 102 133
```





---
# Data.frames


- Data.frame es una lista de vectores, cumple:
  - Las componentes son vectores
  - Cada vector puede se de un tipo de dato distinto
  - Cada elemento, columna es una variable
  - Las columnas tienen el mismo largo
- Se podría decir que un data.frame es como una tabla en una hoja de excel





---
# Data.frames



Crear un data.frame

```r
Nombre &lt;- c('Ana', 'Berni', 'Carlos')
Edad &lt;- c(20,19,20)
Ciudad &lt;- factor(c('Gye', 'Uio', 'Cue'))
df_1  &lt;- data.frame(Nombre, Edad, Ciudad)
df_1
```

```
##   Nombre Edad Ciudad
## 1    Ana   20    Gye
## 2  Berni   19    Uio
## 3 Carlos   20    Cue
```



---
# Data.frames



Crear un data.frame

```r
df_2  &lt;- data.frame( a= Nombre, b= Edad, c= Ciudad)
df_2
```

```
##        a  b   c
## 1    Ana 20 Gye
## 2  Berni 19 Uio
## 3 Carlos 20 Cue
```



---
# Data.frames



Crear un data.frame

```r
df_3  &lt;- data.frame( Nombre= c('Ana', 'Berni', 'Carlos'), 
                     Edad = c(20,19,20), 
                     Ciudad= factor(c('Gye', 'Uio', 'Cue')) )
df_3
```

```
##   Nombre Edad Ciudad
## 1    Ana   20    Gye
## 2  Berni   19    Uio
## 3 Carlos   20    Cue
```




---
# Data.frames



Rownames

```r
rownames(df_3) &lt;- paste('id_',1:3,sep='')
df_3
```

```
##      Nombre Edad Ciudad
## id_1    Ana   20    Gye
## id_2  Berni   19    Uio
## id_3 Carlos   20    Cue
```



---
# Data.frames



Modificar nombre de las variables

```r
names(df_3) &lt;- c('Name', 'Age', 'City')
df_3
```

```
##        Name Age City
## id_1    Ana  20  Gye
## id_2  Berni  19  Uio
## id_3 Carlos  20  Cue
```



---
# Data.frames



Visualizar primeras filas

```r
head(df_3, n=2)
```

```
##       Name Age City
## id_1   Ana  20  Gye
## id_2 Berni  19  Uio
```



---
# Data.frames



Visualizar últimas filas

```r
tail(df_3, n=2)
```

```
##        Name Age City
## id_2  Berni  19  Uio
## id_3 Carlos  20  Cue
```




---
# Data.frames



Visualizar la estructura    
`str` permite ver la estructura de cualquier objeto en R.


```r
str(df_3)
```

```
## 'data.frame':	3 obs. of  3 variables:
##  $ Name: Factor w/ 3 levels "Ana","Berni",..: 1 2 3
##  $ Age : num  20 19 20
##  $ City: Factor w/ 3 levels "Cue","Gye","Uio": 2 3 1
```





---
# Listas



Imaginen un tren de carga donde en cada vagón tienen cosas diferentes, eso es una lista, un objeto que permite tener cualquier clase de objeto en sus posiciones (vagones).


```r
list(1, c(2,3), df_1)
```

```
## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2 3
## 
## [[3]]
##   Nombre Edad Ciudad
## 1    Ana   20    Gye
## 2  Berni   19    Uio
## 3 Carlos   20    Cue
```




---
# Listas



Las posiciones pueden tener nombre y se pueden acceder con `lista$posicion`


```r
lista_1 &lt;- list(A= 1, B= c(2,3), C= df_1)
lista_1$B
```

```
## [1] 2 3
```

```r
lista_1$C
```

```
##   Nombre Edad Ciudad
## 1    Ana   20    Gye
## 2  Berni   19    Uio
## 3 Carlos   20    Cue
```



---
# Estructuras de datos | Objetos


&lt;img src="Imagenes/TiposObjetosR.jpg" width="60%" style="display: block; margin: auto;" /&gt;






---
# Ejemplo: Transacciones bancarias



Entonces, ¿qué tipo de estructura hemos importado?   
R. Un data.frame

```r
str(data_banco)
```

```
## 'data.frame':	24299 obs. of  7 variables:
##  $ Sucursal           : num  62 62 62 62 62 62 62 62 62 62 ...
##  $ Cajero             : num  4820 4820 4820 4820 4820 4820 4820 4820 4820 4820 ...
##  $ ID_Transaccion     : chr  "2" "2" "2" "2" ...
##  $ Transaccion        : chr  "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" ...
##  $ Tiempo_Servicio_seg: num  311 156 248 99 123 172 140 247 183 91 ...
##  $ Satisfaccion       : chr  "Muy Bueno" "Malo" "Regular" "Regular" ...
##  $ Monto              : chr  "2889,3" "1670,69" "3172,49" "1764.92" ...
```





---
class: center, middle, hide_logo

# Entender los datos
## Introducción a los análisis estadísticos




---
# Entender los datos


Luego de importar se debe entender los datos   
- ¿Qué representa cada columna?
- ¿Qué tipo de dato debería tener cada columna?
- ¿Qué granularidad o atomicidad tiene la data?
- Si es que se tiene varios conjuntos de datos ¿Cómo se relacionan los datos?
- A qué periodo de tiempo corresponde la data
- Muchas veces se obtiene la información desde una base de datos y por tanto toca entender la base y el query que genera los datos





---
# Ejemplo - Entender los datos



Podríamos ver las primeras filas

```r
# ver las primeras 5 filas
head(data_sucursal, n = 5)
```

```
##   ID_Sucursal      Sucursal Nuevo_Sistema
## 1          62 Riocentro Sur            No
## 2          85        Centro            Si
## 3         267      Alborada            Si
## 4         443  Mall del Sol            Si
## 5         586     Via Daule            No
```



---
# Ejemplo - Entender los datos



Listar los nombres de las columnas 

```r
# Listar los nombres de las columnas 
names(data_banco)
```

```
## [1] "Sucursal"            "Cajero"              "ID_Transaccion"     
## [4] "Transaccion"         "Tiempo_Servicio_seg" "Satisfaccion"       
## [7] "Monto"
```

```r
names(data_sucursal)
```

```
## [1] "ID_Sucursal"   "Sucursal"      "Nuevo_Sistema"
```




---
# Tipos de datos



Tipos datos en R


```r
1  # Entero
```

```
## [1] 1
```

```r
3.5  # Numérico
```

```
## [1] 3.5
```

```r
im &lt;- 3.5 - 8i # Complejo
Im(im) # Parte imaginaria
```

```
## [1] -8
```

```r
Re(im) # Parte real
```

```
## [1] 3.5
```



---
# Tipos de datos




```r
'a'  # Caracter
```

```
## [1] "a"
```

```r
fecha &lt;- lubridate::ymd("2010-01-01") # Fecha
data_serie &lt;- ts(1:24, start = 2014) # Serie de tiempo
data_serie
```

```
## Time Series:
## Start = 2014 
## End = 2037 
## Frequency = 1 
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
```





---
# Tipos de datos - factor



- Util para tipos de datos ordinales
- x: es el vector de información 
- levels: los niveles del factor labels: nombre de los niveles 
- El factor puede tener un orden específico


```r
# Crear un factor ordenado
data_factor  &lt;- factor(x= c('alto', 'bajo', 'alto', 'alto'), levels = c('bajo', 'mediano', 'alto'), ordered = T)
data_factor # Mostrar el factor
```

```
## [1] alto bajo alto alto
## Levels: bajo &lt; mediano &lt; alto
```




---
# Tipos de datos



Datos lógicos y valores perdidos


```r
TRUE  # LOGICO
```

```
## [1] TRUE
```

```r
FALSE # LOGICO
```

```
## [1] FALSE
```

```r
NA    # No disponible, perdido
```

```
## [1] NA
```
Nota: Los `NA` requieren un tratamiento especial



---
# Tipos de datos



Casos especiales


```r
1/0   # Infinito
```

```
## [1] Inf
```

```r
-1/0   # Infinito negativo
```

```
## [1] -Inf
```

```r
Inf/Inf # No un Numero
```

```
## [1] NaN
```


---
# Tipos de datos



Qué creen que resulte de lo siguiente?

```r
(0:3)^Inf
```


---
# Tipos de datos


Qué creen que resulte de lo siguiente?

```r
0:3 # es una secuencia
```

```
## [1] 0 1 2 3
```

```r
(0:3)^Inf  # ahora se eleva cada elemnto a Inf
```

```
## [1]   0   1 Inf Inf
```




---
# Tipos de variables 

Tipos de variables y su correspondencia en R

&lt;img src="Imagenes/TiposVariable.png" width="60%" style="display: block; margin: auto;" /&gt;




---
# Tipos de datos



Al importar los datos es posible que no estén en el formato correcto, podemos pasar de un tipo de dato a otro (siempre que sea posible), usando R-base



```r
as.numeric(x)
```

```
## [1] 11 12 13 14
```

```r
as.integer(im)
```

```
## Warning: partes imaginarias descartadas en la coerción
```

```
## [1] 3
```

```r
as.character(data_factor)
```

```
## [1] "alto" "bajo" "alto" "alto"
```

```r
as.factor(x)
```

```
## [1] 11 12 13 14
## Levels: 11 12 13 14
```



---
# Tipos de datos



También se puede usar el paquete *readr* del *tidyverse* (estas funciones son las que se usan automáticamente al importar desde el menú de RStudio, *ojo*: Parten de vectores de tipo character).   
Para datos numéricos tenemos varias funiones, `parse_number` es la menos restrictiva (elimina lo que no sea número y convierte), `parse_integer` y `parse_double` esperan valores en el formato indicado



```r
library(tidyverse)
parse_number(c("$1,234.5", "$12.45"))
```

```
## [1] 1234.50   12.45
```

```r
parse_double(c("1234.5", "12.45"))
```

```
## [1] 1234.50   12.45
```

```r
parse_integer(c("$1,234.5", "$12.45")) # Error
```

```
## [1] NA NA
## attr(,"problems")
## # A tibble: 2 x 4
##     row   col expected   actual  
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;   
## 1     1    NA an integer $1,234.5
## 2     2    NA an integer $12.45
```




---
# Tipos de datos

Para datos de tipo character 


```r
as.character(data_factor)
```

```
## [1] "alto" "bajo" "alto" "alto"
```

```r
as.character(lubridate::now())
```

```
## [1] "2020-10-16 13:07:52"
```

```r
## parse_character(data_factor) #ERROR
```




---
# Tipos de datos



Para datos de tipo factor se requiere especificar los niveles, y si un dato no está en los niveles se muestra un warning 



```r
factor(c("Alto", "Bajo", "Medio", "Alto"), 
       levels = c("Alto", "Medio", "Bajo"), ordered = T)
```

```
## [1] Alto  Bajo  Medio Alto 
## Levels: Alto &lt; Medio &lt; Bajo
```

```r
factor(c("Alto", "Bajo", "Medio bajo", "Alto"), 
             levels = c("Alto", "Medio", "Bajo")) #ERROR
```

```
## [1] Alto Bajo &lt;NA&gt; Alto
## Levels: Alto Medio Bajo
```




---
# Tipos de datos



Para datos de tipo factor se requiere especificar los niveles, y si un dato no está en los niveles se muestra un warning 



```r
parse_factor(c("Alto", "Bajo", "Medio", "Alto"), levels = c("Alto", "Medio", "Bajo"), ordered = T)
```

```
## [1] Alto  Bajo  Medio Alto 
## Levels: Alto &lt; Medio &lt; Bajo
```

```r
parse_factor(c("Alto", "Bajo", "Medio bajo", "Alto"), 
             levels = c("Alto", "Medio", "Bajo")) #ERROR
```

```
## Warning: 1 parsing failure.
## row col           expected     actual
##   3  -- value in level set Medio bajo
```

```
## [1] Alto Bajo &lt;NA&gt; Alto
## attr(,"problems")
## # A tibble: 1 x 4
##     row   col expected           actual    
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;     
## 1     3    NA value in level set Medio bajo
## Levels: Alto Medio Bajo
```




---
# Tipos de datos



Para datos de tipo fecha tenemos: 


```r
parse_date("2010-10-01")
```

```
## [1] "2010-10-01"
```

```r
parse_date("2010/10/01")
```

```
## [1] "2010-10-01"
```
Sin embargo los tipos de dato fecha tienen muchos caracterísitcas que veremos más adelante.




---
# Entender los datos


Luego de importar se debe entender los datos   
- ¿Qué representa cada columna?
- ¿Qué tipo de dato debería tener cada columna?
- ¿Qué granularidad o atomicidad tiene la data?
- Si es que se tiene varios conjuntos de datos ¿Cómo se relacionan los datos?
- A qué periodo de tiempo corresponde la data
- Muchas veces se obtiene la información desde una base de datos y por tanto toca entender la base y el query que genera los datos




---
# Entender los datos - Ejemplo



¿Están bien nuestros tipos de datos?      
...


```r
# Ver la estructura del data.frame
str(data_banco)
```

```
## 'data.frame':	24299 obs. of  7 variables:
##  $ Sucursal           : num  62 62 62 62 62 62 62 62 62 62 ...
##  $ Cajero             : num  4820 4820 4820 4820 4820 4820 4820 4820 4820 4820 ...
##  $ ID_Transaccion     : chr  "2" "2" "2" "2" ...
##  $ Transaccion        : chr  "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" ...
##  $ Tiempo_Servicio_seg: num  311 156 248 99 123 172 140 247 183 91 ...
##  $ Satisfaccion       : chr  "Muy Bueno" "Malo" "Regular" "Regular" ...
##  $ Monto              : chr  "2889,3" "1670,69" "3172,49" "1764.92" ...
```




---
# Entender los datos - Ejemplo



¿Está bien nuestros tipos de datos?   
Si no lo están entonces debemos transformarlos, para esto aprenderemos sobre manipulación de datos.



```r
# Ver la estructura del data.frame
str(data_banco)
```

```
## 'data.frame':	24299 obs. of  7 variables:
##  $ Sucursal           : num  62 62 62 62 62 62 62 62 62 62 ...
##  $ Cajero             : num  4820 4820 4820 4820 4820 4820 4820 4820 4820 4820 ...
##  $ ID_Transaccion     : chr  "2" "2" "2" "2" ...
##  $ Transaccion        : chr  "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" ...
##  $ Tiempo_Servicio_seg: num  311 156 248 99 123 172 140 247 183 91 ...
##  $ Satisfaccion       : chr  "Muy Bueno" "Malo" "Regular" "Regular" ...
##  $ Monto              : chr  "2889,3" "1670,69" "3172,49" "1764.92" ...
```




---
class: center, middle, hide_logo

# Manipulacion de datos - Basico
## Introducción a R 





---
# Manipulacion de datos


R tiene sus comandos predeterminados para manipular datos, esto se conoce como *R Base*, sin embargo existen varios paquetes que simplifican esta tarea, en este curso veremos como hacerlo con el paquete *dplyr* (y *magrittr*) que están dentro del conjunto de paquetes llamado **tidyverse**


```r
# Cargar la librería
library(tidyverse)
```



---
# Tibbles (un dataframe mejorado): 			



Tibble es un objeto del paquete dplyr, entre las mejoras que da es que no imprime todo el objeto en pantalla, sino un resumen del mismo. (más información tipeando ?tibble)



```r
# Convertir el data_banco a un tibble
data_banco &lt;- tbl_df( data_banco) 
```

```
## Warning: `tbl_df()` is deprecated as of dplyr 1.0.0.
## Please use `tibble::as_tibble()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.
```

```r
# Muestra data_banco
data_banco
```

```
## # A tibble: 24,299 x 7
##    Sucursal Cajero ID_Transaccion Transaccion Tiempo_Servicio~ Satisfaccion
##       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;       
##  1       62   4820 2              Cobro/Pago~              311 Muy Bueno   
##  2       62   4820 2              Cobro/Pago~              156 Malo        
##  3       62   4820 2              Cobro/Pago~              248 Regular     
##  4       62   4820 2              Cobro/Pago~               99 Regular     
##  5       62   4820 2              Cobro/Pago~              123 Muy Bueno   
##  6       62   4820 2              Cobro/Pago~              172 Bueno       
##  7       62   4820 2              Cobro/Pago~              140 Regular     
##  8       62   4820 2              Cobro/Pago~              247 Bueno       
##  9       62   4820 2              Cobro/Pago~              183 Muy Bueno   
## 10       62   4820 2              Cobro/Pago~               91 Muy Bueno   
## # ... with 24,289 more rows, and 1 more variable: Monto &lt;chr&gt;
```




---
# Seleccionar columnas: 	select()



Seleccionar las columnas Transaccion, Tiempo_Servicio_seg del data.frame data_banco

```r
# Seleccionar las columnas Transaccion, Tiempo_Servicio_seg del data.frame data_banco
# Note que como no se asignó, R evalúa la expresión y presenta el resultado
select( data_banco, Transaccion, Tiempo_Servicio_seg) 
```

```
## # A tibble: 24,299 x 2
##    Transaccion              Tiempo_Servicio_seg
##    &lt;chr&gt;                                  &lt;dbl&gt;
##  1 Cobro/Pago (Cta externa)                 311
##  2 Cobro/Pago (Cta externa)                 156
##  3 Cobro/Pago (Cta externa)                 248
##  4 Cobro/Pago (Cta externa)                  99
##  5 Cobro/Pago (Cta externa)                 123
##  6 Cobro/Pago (Cta externa)                 172
##  7 Cobro/Pago (Cta externa)                 140
##  8 Cobro/Pago (Cta externa)                 247
##  9 Cobro/Pago (Cta externa)                 183
## 10 Cobro/Pago (Cta externa)                  91
## # ... with 24,289 more rows
```



---
# Operador Pipe: %&gt;%



El operador Pipe %&gt;% del paquete magrittr permiten que el código sea más legible porque:

- Permite secuencias estructurantes de operaciones de datos de izquierda a derecha (a diferencia de dentro y fuera),
- Evitando llamadas a funciones anidadas,
- Minimiza la necesidad de variables locales y definiciones de funciones
- Facilita agregar pasos en cualquier lugar de la programación



---
# Operador Pipe: %&gt;%



Funciona así:
- `x %&gt;% f` es equivalente a `f(x)`
- `x %&gt;% f(y)` es equivalente a `f(x, y)`
- `x %&gt;% f %&gt;% g %&gt;% h` es equivalente a `h(g(f(x)))`
- `x %&gt;% f(y = nrow(.), z = ncol(.))` es equivalente a `f(x, y = nrow(x), z = ncol(x))`
- `x %&gt;% {f(y = nrow(.), z = ncol(.))}` is equivalent to `f(y = nrow(x), z = ncol(x))`
- `%$%` permite seleccionar columas



---
# Operador Pipe: %&gt;%




```r
library(magrittr)
data_banco %&gt;% names
```

```
## [1] "Sucursal"            "Cajero"              "ID_Transaccion"     
## [4] "Transaccion"         "Tiempo_Servicio_seg" "Satisfaccion"       
## [7] "Monto"
```

```r
data_banco %&gt;% dim
```

```
## [1] 24299     7
```

```r
data_banco %&gt;% names %&gt;% length 
```

```
## [1] 7
```

```r
length(names(data_banco)) # equivalencia del código anterior
```

```
## [1] 7
```


---
# Operador Pipe: %&gt;%




```r
data_banco %&gt;% head(, n= 5)
```

```
## # A tibble: 5 x 7
##   Sucursal Cajero ID_Transaccion Transaccion Tiempo_Servicio~ Satisfaccion Monto
##      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;
## 1       62   4820 2              Cobro/Pago~              311 Muy Bueno    2889~
## 2       62   4820 2              Cobro/Pago~              156 Malo         1670~
## 3       62   4820 2              Cobro/Pago~              248 Regular      3172~
## 4       62   4820 2              Cobro/Pago~               99 Regular      1764~
## 5       62   4820 2              Cobro/Pago~              123 Muy Bueno    1835~
```




---
# Seleccionar columnas: 	select()



Seleccionar las columnas Transaccion, Tiempo_Servicio_seg del data.frame data_banco pero usando `%&gt;%`, lo que permite programar como si se escribiese "del data_banco, selecciona las columnas Transaccion y Tiempo_Servicio_seg"


```r
# Seleccionar las columnas Transaccion, Tiempo_Servicio_seg del data.frame data_banco
# Note que como no se asignó, R evalúa la expresión y presenta el resultado
# Se lee, del data_banco, selecciona las columnas Transaccion y Tiempo_Servicio_seg
# data_banco[ , c("Transaccion", "Tiempo_Servicio_seg") ] ## Base de R
data_banco %&gt;% select( Transaccion, Tiempo_Servicio_seg) 
```

```
## # A tibble: 24,299 x 2
##    Transaccion              Tiempo_Servicio_seg
##    &lt;chr&gt;                                  &lt;dbl&gt;
##  1 Cobro/Pago (Cta externa)                 311
##  2 Cobro/Pago (Cta externa)                 156
##  3 Cobro/Pago (Cta externa)                 248
##  4 Cobro/Pago (Cta externa)                  99
##  5 Cobro/Pago (Cta externa)                 123
##  6 Cobro/Pago (Cta externa)                 172
##  7 Cobro/Pago (Cta externa)                 140
##  8 Cobro/Pago (Cta externa)                 247
##  9 Cobro/Pago (Cta externa)                 183
## 10 Cobro/Pago (Cta externa)                  91
## # ... with 24,289 more rows
```



---
# Seleccionar columnas y aplicar una función



Seleccionar la columna Tiempo_Servicio_seg y obtener un boxplot


```r
# Seleccionar la columna Tiempo_Servicio_seg y obtener un boxplot
# boxplot(data_banco$Tiempo_Servicio_seg) ## Base de R
data_banco %&gt;% select(Tiempo_Servicio_seg)  %&gt;% boxplot
```

&lt;img src="01_Intro_Importac_Manipul_Descriptivas_files/figure-html/unnamed-chunk-63-1.png" style="display: block; margin: auto;" /&gt;




---
# Seleccionar columnas y aplicar una función



Seleccionar la columna Tiempo_Servicio_seg y obtener los fivenumbers de Tukey


```r
# Seleccionar la columna Tiempo_Servicio_seg y obtener los fivenumbers de Tukey
data_banco %$% fivenum(Tiempo_Servicio_seg, na.rm= TRUE)
```

```
## [1]   18.13177   75.69119  122.45229  197.73046 1602.69832
```




---
# Seleccionar columnas: 	select()



Seleccionar y ver en el visor de datos de RStudio


```r
# Seleccionar y ver en el visor de datos de RStudio
data_banco %&gt;% select( Transaccion, Tiempo_Servicio_seg) %&gt;% View
```




---
# Seleccionar columnas: 	select()



Seleccionar todas las columnas menos Cajero


```r
# Seleccionar todas las columnas menos Cajero
data_banco %&gt;% select( -Cajero) %&gt;% View
```



---
# Seleccionar columnas: 	select()



Seleccionar según nombre de la columna/variable. 



```r
# Seleccionar todas las columnas cuyo nombre contenga el texto "Tra"
data_banco %&gt;% select( contains("Tra")) %&gt;% View
# Seleccionar todas las columnas cuyo nombre inicie con "S"
data_banco %&gt;% select( starts_with("S")) %&gt;% View
# Seleccionar todas las columnas cuyo nombre finalice con "on"
data_banco %&gt;% select( ends_with("on")) %&gt;% View
# Seleccionar todas las columnas cuyo nombre contenga una "r" o un "sa"
data_banco %&gt;% select( matches("r?sa")) %&gt;% View
# Más información sobre expresiones regulares usando: ?base::regex
```




---
# Filtrar/Seleccionar filas: 	filter()



Filtrar las filas según las condiciones dadas en `filter()`, pero para esto debemos entender los operadores de relación y lógicos en R





---
# Operadores de relación




```r
3 == 4 # Igualdad
```

```
## [1] FALSE
```

```r
3 != 4 # Desigualdad
```

```
## [1] TRUE
```

```r
3 &gt; 4  # Mayor que 
```

```
## [1] FALSE
```

```r
3 &lt;= 4 # Menor igual que
```

```
## [1] TRUE
```




---
# Operadores lógicos





```r
! FALSE  # No
```

```
## [1] TRUE
```

```r
TRUE &amp; FALSE  # Y
```

```
## [1] FALSE
```

```r
TRUE | FALSE  # O
```

```
## [1] TRUE
```

```r
xor(TRUE,TRUE) # Ó excluyente
```

```
## [1] FALSE
```

```r
TRUE &amp; NA # Cuidado especial con los NA
```

```
## [1] NA
```



---
# Operadores lógicos




```r
xor(TRUE,TRUE) # Ó excluyente
```

```
## [1] FALSE
```

```r
TRUE &amp; NA # Cuidado especial con los NA
```

```
## [1] NA
```



---
# Filtrar/Seleccionar filas: 	filter()



Filtrar las filas según las condiciones dadas en filter()



```r
# Filtrar las filas correspondientes a la sucursal 62
data_banco %&gt;% filter( Sucursal== 62 ) %&gt;% View
# Filtrar las filas correspondientes a la sucursal 62 y hayan durado más de 120 segundos
data_banco %&gt;% filter( Sucursal== 62 &amp; Tiempo_Servicio_seg &gt; 120 ) %&gt;% View
# Filtrar las filas correspondientes a la sucursal 62,  hayan durado 
# más de 120 segundos y la evaluación a la satisfacción sea Bueno
data_banco %&gt;% filter( Sucursal== 62 &amp; Tiempo_Servicio_seg &gt; 120 &amp; Satisfaccion== "Muy Bueno") %&gt;% View
```




---
# Filtrar filas y seleccionar




```r
# Con el data banco
# Filtrar las filas correspondientes a la sucursal 85
# calcular la correlacion entre Tiempo_Servicio_seg y Monto
data_banco %&gt;% # Operador pipe total
  filter( Sucursal== 85 ) %$%  # Operador pipe para seleccion de columnas
  cor(Tiempo_Servicio_seg, as.numeric(Monto))
```

```
## [1] 0.5339392
```




---
# Ordenar las filas: 		arrange()



Ordenar las filas según lo expresado en arrange()



```r
# Ordenar por la satisfaccion
data_banco %&gt;% arrange( Satisfaccion ) %&gt;% View
# Ordenar cada Transaccion y dentro de cada transaccion de mayor a menor por tiempo de servicio
data_banco %&gt;% arrange( Transaccion, desc(Tiempo_Servicio_seg) ) %&gt;% View
```




---
# Crear o modificar columnas/variables  		mutate()



Crear una nueva columna con el tiempo en minutos


```r
# Crear una nueva columna con el tiempo en minutos
data_banco %&gt;% mutate(Tiempo_Servicio_Min= Tiempo_Servicio_seg/60)
```

```
## # A tibble: 24,299 x 8
##    Sucursal Cajero ID_Transaccion Transaccion Tiempo_Servicio~ Satisfaccion
##       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;       
##  1       62   4820 2              Cobro/Pago~              311 Muy Bueno   
##  2       62   4820 2              Cobro/Pago~              156 Malo        
##  3       62   4820 2              Cobro/Pago~              248 Regular     
##  4       62   4820 2              Cobro/Pago~               99 Regular     
##  5       62   4820 2              Cobro/Pago~              123 Muy Bueno   
##  6       62   4820 2              Cobro/Pago~              172 Bueno       
##  7       62   4820 2              Cobro/Pago~              140 Regular     
##  8       62   4820 2              Cobro/Pago~              247 Bueno       
##  9       62   4820 2              Cobro/Pago~              183 Muy Bueno   
## 10       62   4820 2              Cobro/Pago~               91 Muy Bueno   
## # ... with 24,289 more rows, and 2 more variables: Monto &lt;chr&gt;,
## #   Tiempo_Servicio_Min &lt;dbl&gt;
```




---
# Crear o modificar columnas/variables  		mutate()



Crear una nueva columna con el tiempo en minutos


```r
# Crear una nueva columna con el tiempo en minutos
data_banco %&gt;% mutate(Tiempo_Servicio_Min= Tiempo_Servicio_seg/60)
```

```
## # A tibble: 24,299 x 8
##    Sucursal Cajero ID_Transaccion Transaccion Tiempo_Servicio~ Satisfaccion
##       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;       
##  1       62   4820 2              Cobro/Pago~              311 Muy Bueno   
##  2       62   4820 2              Cobro/Pago~              156 Malo        
##  3       62   4820 2              Cobro/Pago~              248 Regular     
##  4       62   4820 2              Cobro/Pago~               99 Regular     
##  5       62   4820 2              Cobro/Pago~              123 Muy Bueno   
##  6       62   4820 2              Cobro/Pago~              172 Bueno       
##  7       62   4820 2              Cobro/Pago~              140 Regular     
##  8       62   4820 2              Cobro/Pago~              247 Bueno       
##  9       62   4820 2              Cobro/Pago~              183 Muy Bueno   
## 10       62   4820 2              Cobro/Pago~               91 Muy Bueno   
## # ... with 24,289 more rows, and 2 more variables: Monto &lt;chr&gt;,
## #   Tiempo_Servicio_Min &lt;dbl&gt;
```


---
# Crear o modificar columnas/variables  		mutate()



Crear una nueva columna con el tiempo en minutos


```r
# Crear una nueva columna con el tiempo en minutos
data_banco %&gt;% mutate(Tiempo_Servicio_Min= Tiempo_Servicio_seg/60)
```


Nótese que **no se asignó**, el objeto data_banco no tiene la columna Tiempo_Servicio_Min





---
# Crear o modificar columnas/variables  		mutate()



Crear una nueva columna con el tiempo en minutos


```r
# Crear una nueva columna con el tiempo en minutos
data_banco &lt;- data_banco %&gt;%
  mutate(Tiempo_Servicio_Min= Tiempo_Servicio_seg/60)
# Mostrar
data_banco
```

```
## # A tibble: 24,299 x 8
##    Sucursal Cajero ID_Transaccion Transaccion Tiempo_Servicio~ Satisfaccion
##       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;       
##  1       62   4820 2              Cobro/Pago~              311 Muy Bueno   
##  2       62   4820 2              Cobro/Pago~              156 Malo        
##  3       62   4820 2              Cobro/Pago~              248 Regular     
##  4       62   4820 2              Cobro/Pago~               99 Regular     
##  5       62   4820 2              Cobro/Pago~              123 Muy Bueno   
##  6       62   4820 2              Cobro/Pago~              172 Bueno       
##  7       62   4820 2              Cobro/Pago~              140 Regular     
##  8       62   4820 2              Cobro/Pago~              247 Bueno       
##  9       62   4820 2              Cobro/Pago~              183 Muy Bueno   
## 10       62   4820 2              Cobro/Pago~               91 Muy Bueno   
## # ... with 24,289 more rows, and 2 more variables: Monto &lt;chr&gt;,
## #   Tiempo_Servicio_Min &lt;dbl&gt;
```




---
# Nuevas columnas transmute()



Para conservar sólamente las nuevas columnas se usa  transmute()



```r
# Crear una nueva columna con el tiempo en minutos
data_banco %&gt;%
  transmute(Tiempo_Servicio_Min= Tiempo_Servicio_seg/60)
```

```
## # A tibble: 24,299 x 1
##    Tiempo_Servicio_Min
##                  &lt;dbl&gt;
##  1                5.18
##  2                2.6 
##  3                4.13
##  4                1.65
##  5                2.05
##  6                2.87
##  7                2.33
##  8                4.12
##  9                3.05
## 10                1.52
## # ... with 24,289 more rows
```




---
# Entender los datos - Ejemplo



¿Está bien nuestros tipos de datos?   
Si no lo están entonces debemos transformarlos, para esto aprenderemos sobre manipulación de datos.



```r
# Ver la estructura del data.frame
str(data_banco)
```

```
## tibble [24,299 x 8] (S3: tbl_df/tbl/data.frame)
##  $ Sucursal           : num [1:24299] 62 62 62 62 62 62 62 62 62 62 ...
##  $ Cajero             : num [1:24299] 4820 4820 4820 4820 4820 4820 4820 4820 4820 4820 ...
##  $ ID_Transaccion     : chr [1:24299] "2" "2" "2" "2" ...
##  $ Transaccion        : chr [1:24299] "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" "Cobro/Pago (Cta externa)" ...
##  $ Tiempo_Servicio_seg: num [1:24299] 311 156 248 99 123 172 140 247 183 91 ...
##  $ Satisfaccion       : chr [1:24299] "Muy Bueno" "Malo" "Regular" "Regular" ...
##  $ Monto              : chr [1:24299] "2889,3" "1670,69" "3172,49" "1764.92" ...
##  $ Tiempo_Servicio_Min: num [1:24299] 5.18 2.6 4.13 1.65 2.05 ...
```





---
# Ejemplo - Manipulacion de datos



Lo primero que necesitamos es corregir los tipos de datos, nótese que   
- **Monto** tiene una mezcla de "," y "."   
- **Sucursal** y **Cajero** deberían ser de tipo character   
- **Satisfaccion** debe ser factor ordenado



```r
data_banco &lt;- data_banco %&gt;%
  mutate( Monto= str_replace(Monto, pattern = ",", replacement = ".") ) %&gt;%
  mutate(Sucursal= as.character(Sucursal),
         Cajero = as.character(Cajero),
         Satisfaccion = parse_factor(Satisfaccion, 
                                     levels= c('Muy Malo', 'Malo', 'Regular', 'Bueno', 'Muy Bueno'), ordered = T),
         Monto= parse_number(Monto, locale = locale(decimal_mark = "."))) 
```







---
# Ejemplo - Explorar los datos


Con los datos corregidos, podemos empezar a explorar, para ello además de poder seleccionar columnas o filtrar filas, debemos poder calcular medidas estadísticas que nos permitan entender nuestros datos




---
class: center, middle, hide_logo

# Estadística descriptiva - Estadisticos|Medidas
## Introducción al análisis de datos 





---
# Medidas de Tendencia Central

Media.- Promedio de los valores  
- Se la puede entender como el punto de equilibrio 
- Muy sensible a valores aberrantes
- En R: mean(x, na.rm= TRUE)


Media Acotada.- Promedio de los valores, pero quitando un porcentaje de valores extremos.
- Es menos sensible a valores aberrantes
- Se puede perder información importante
- En R: mean(x, na.rm= TRUE, trim)




---
# Medidas de Tendencia Central

Mediana.- Punto medio de los valores una vez que se han ordenado de menor a mayor o de mayor a menor.
- Valor importante pero poco usado
- No es sensible a valores aberrantes
- En R: median(x, na.rm= TRUE)


Media Ponderada.- Promedio de los valores, pero asignando un peso diferente a cada valor.
- Normalmente se utiliza cuando se tiene datos agrupados
- Es también sensible a valores aberrantes
- En R: weighted.mean(x, w, ..., na.rm = TRUE)




---
# Medidas de Tendencia Central

Entendiendo media vs mediana
&lt;img src="Imagenes/Media_vs_Mediana.JPG" width="60%" style="display: block; margin: auto;" /&gt;




---
# Medidas de Tendencia Central

La idea general de los **métodos robustos** es obtener estimadores que no se vean muy afectados por los valores aberrantes.   
Media Robusta de Huber- Propuesto por él en los 60s, es un método asigna (por medio de un algoritmo) un peso a cada observación, siendo los outliers castigados con un peso menor.   
- Poco usado pero totalmente recomendado. 
- Da un valor entre la media y la mediana
- Tiene un algoritmo numérico inmerso, por lo que si cálculo no es inmediato   
- En R: huber(y, k = 1.5, tol = 1e-06)   




---
# Medidas de Tendencia Central

Moda.- Valor de la observación que aparece con mayor frecuencia.
- Mejor análisis se obtiene con una tabla de frecuencias
- En R:
  - library('modeest')
  - mlv(x)





---
# Medidas de Tendencia Central


Calcular las medidas de Tendencia central para la data de Banco 


```r
# Media
# mean(data_banco$Tiempo_Servicio_seg, na.rm = TRUE) ## Base R
data_banco %$% mean(Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 155.58
```

```r
# Media acotada al 10%
data_banco %$% mean(Tiempo_Servicio_seg, trim = 0.05, na.rm = TRUE)
```

```
## [1] 141.9233
```



---
# Medidas de Tendencia Central


Calcular las medidas de Tendencia central para la data de Banco 


```r
# Mediana
data_banco %$% median(Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 122.4523
```

```r
# Media de Huber
# MASS::huber(data_banco$Tiempo_Servicio_seg)$mu ## Base R
data_banco %$% MASS::huber(Tiempo_Servicio_seg) %&gt;% as.data.frame() %&gt;% select(mu)
```

```
##         mu
## 1 138.0164
```


---
# Medidas de Tendencia Central

Calcular las medidas de Tendencia central para la data de Banco 


```r
# Cargar paquete
library('modeest')
```

```
## Warning: package 'modeest' was built under R version 3.6.3
```

```
## Registered S3 method overwritten by 'rmutil':
##   method         from
##   print.response httr
```

```r
# Moda
mlv(data_banco$Tiempo_Servicio_seg)
```

```
## Warning: argument 'method' is missing. Data are supposed to be continuous. 
##             Default method 'shorth' is used
```

```
## [1] 84.13594
```





---
class: hide_logo 
background-image: url("Imagenes/DoloresCabezaPaEstadisticos.png")


---
# Medidas de Posición



- Min y Max
  - En R, `min(x, na.rm = TRUE)`, `max(x, na.rm = TRUE)`
- Cuartiles.- Dividen al conjunto de observaciones en **4** partes iguales
  - El segundo cuartil es la mediana
  - En R `quantile(x , probs = c(0.25, 0.50, 0.75))`
- Deciles.- Dividen al conjunto de observaciones en **10** partes iguales
  - El quinto decil sería igual a la mediana
  - En R `quantile(x , probs = seq(from = 0.1, to = 1, by = 0.1))`
- Centiles.- Dividen al conjunto de observaciones en **100** partes iguales
  - El quincuagésimo centil es la mediana
  - En R `quantile(x, probs )`




---
# Medidas de Posición

Entendiendo los cuartiles

![Cuartiles](Imagenes/Cuartiles.JPG)




---
# Medidas de Posición


Calcular las medidas de Posición para el tiempo de servicio data de Banco 


```r
# Minimo y Máximo
min(data_banco$Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 18.13177
```

```r
max(data_banco$Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 1602.698
```

```r
# Cuartiles
quantile(data_banco$Tiempo_Servicio_seg , probs = c(0.25, 0.50, 0.75))
```

```
##       25%       50%       75% 
##  75.69119 122.45229 197.73046
```


---
# Medidas de Posición


Calcular las medidas de Posición para el tiempo de servicio data de Banco 


```r
# Deciles
quantile(data_banco$Tiempo_Servicio_seg , probs = seq(from = 0.1, to = 1, by = 0.1))
```

```
##       10%       20%       30%       40%       50%       60%       70%       80% 
##   49.6230   67.0000   84.0000  102.0000  122.4523  146.9901  178.8348  220.2469 
##       90%      100% 
##  298.7826 1602.6983
```

```r
# Centil 5% y 95%
quantile(data_banco$Tiempo_Servicio_seg , probs = c(0.05, 0.95))
```

```
##       5%      95% 
##  39.0000 382.9779
```


---
# Medidas de Posición - Boxplot


Boxplot.- Muestra gráficamente las medidas de posición



```r
# Un primer Boxplot
boxplot(data_banco$Tiempo_Servicio_seg)
```

&lt;img src="01_Intro_Importac_Manipul_Descriptivas_files/figure-html/unnamed-chunk-87-1.png" style="display: block; margin: auto;" /&gt;



---
# Medidas de Posición - Boxplot


Boxplot.- Muestra gráficamente las medidas de posición


```r
boxplot(data_banco$Tiempo_Servicio_seg, main= "Boxplot para Tiempo de Servicio (seg)", ylab= "Tiempo")
```

&lt;img src="01_Intro_Importac_Manipul_Descriptivas_files/figure-html/unnamed-chunk-88-1.png" style="display: block; margin: auto;" /&gt;


---
# Medidas de Posición - Boxplot


Boxplot.- Muestra gráficamente las medidas de posición  
Se puede usar el paquete ggplot2 para gráficos profesionales, esto no se verá en el presente curso, sin mebargo se lo muestra:


```r
library("ggplot2")
ggplot(data = data_banco, aes(x = "", y = Tiempo_Servicio_seg)) + 
  geom_boxplot() +
   coord_flip()
```

&lt;img src="01_Intro_Importac_Manipul_Descriptivas_files/figure-html/unnamed-chunk-89-1.png" style="display: block; margin: auto;" /&gt;




---
# Medidas de Dispersión



- Varianza.- Media aritmética de las desviaciones de la media elevadas al cuadrado
  - `\(s^2 = \frac {\sum (x - \bar{x})^2}{n-1}\)`
  - En R: var(x, na.rm = TRUE)
- Desviación Estándar.- Raíz cuadrada de la varianza.
  - Esta medida se utiliza frecuentemente para realizar comparaciones entre dos conjuntos de datos
  - `\(s =  \sqrt{\frac {\sum (x - \bar{x})^2}{n-1}}\)`
  - En R: sd(x, na.rm = TRUE)
- Mediana de las desviaciones absolutas.- Estimador Robusto
  - `\(mad = mediana[x - mediana(x)]\)`
  




---
# Medidas de Dispersión



- Rango intercuartil.- Distancia entre el cuartil 1 y 3
  - En R IQR(x, na.rm = TRUE)
- Rango.- Diferencia entre maximo y minimo valor
  - En R diff(range(x, na.rm = TRUE))
  




---
# Medidas de Dispersión


Calcular las medidas de dispersión


```r
# Varianza
var(data_banco$Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 14402.27
```

```r
# Desviacion
sd(data_banco$Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 120.0095
```

```r
# Mediana de las desviaciones absolutas
mad(data_banco$Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 82.35503
```



---
# Medidas de Dispersión


Calcular las medidas de dispersión


```r
# Rango intercuartil
IQR(data_banco$Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1] 122.0393
```

```r
# Min Max
range(data_banco$Tiempo_Servicio_seg, na.rm = TRUE)
```

```
## [1]   18.13177 1602.69832
```

```r
# Rango
diff(range(data_banco$Tiempo_Servicio_seg, na.rm = TRUE))
```

```
## [1] 1584.567
```




---
class: inverse, center, middle, hide_logo

# FIN

## Curso: Bases para Data Science - Estadística, R y Python
### Zulemma Bazurto / Néstor Montaño

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
